import pytest
import numpy as np

from verloc.localization import Localizer
from verloc.verification import Verifier
from verloc.inputs import Network
from verloc.propagation import Propagation
from verloc.performance_eval import LocalizationPerformance

# -------------------------------------------
# LOCALIZER
# -------------------------------------------
@pytest.fixture
def loc_object():
    ref_locations = [(48.3200536664685,17.3730031429023),(37.296958333728,-7.16827975993671),(43.9945935973249,1.94223265355784),(50.0273740732463,14.2282159698372),(52.1422852469279,8.90012187464632),(51.5425455970012,-0.524754316417102),(52.9583589143844,20.5314108264791),(48.2466097676995,19.2199740585775),(49.0111025316085,17.1787212134877),(45.2347327821924,10.044872158239)]
    my_times = np.array([0.0207999987351644,0.0403852899153343,0.0315982400928896,0.0206491303399721,0.0232163019584066,0.0313142956020275,0.0212168518556044,0.0190997238594389,0.0195392442336077,0.0269385328683919])
    their_times = np.array([0.0216293782262918,0.0402697867628947,0.0315473818748311,0.0203570647624914,0.0245536181917579,0.0340079135970687,0.0238622558888451,0.0191199543772947,0.0198910333145327,0.0267000667288268])

    loc = Localizer(my_times, their_times, ref_locations)

    return loc

@pytest.fixture
def ver_object():
    ref_locations = [(48.3200536664685,17.3730031429023),(37.296958333728,-7.16827975993671),(43.9945935973249,1.94223265355784),(50.0273740732463,14.2282159698372),(52.1422852469279,8.90012187464632),(51.5425455970012,-0.524754316417102),(52.9583589143844,20.5314108264791),(48.2466097676995,19.2199740585775),(49.0111025316085,17.1787212134877),(45.2347327821924,10.044872158239)]
    my_times = np.array([0.0207999987351644,0.0403852899153343,0.0315982400928896,0.0206491303399721,0.0232163019584066,0.0313142956020275,0.0212168518556044,0.0190997238594389,0.0195392442336077,0.0269385328683919])
    their_times = np.array([0.0216293782262918,0.0402697867628947,0.0315473818748311,0.0203570647624914,0.0245536181917579,0.0340079135970687,0.0238622558888451,0.0191199543772947,0.0198910333145327,0.0267000667288268])
    schedule = [2,5,4,7,8,9,10,22,14,1]

    ver = Verifier(my_times, their_times, schedule, ref_locations)

    return ver

@pytest.fixture
def loc_performance_object():
    physical_locations = [(48.3200536664685, 17.3730031429023), (37.296958333728, -7.16827975993671), (43.9945935973249, 1.94223265355784), (50.0273740732463, 14.2282159698372), (52.1422852469279, 8.90012187464632), (51.5425455970012, -0.524754316417102), (52.9583589143844, 20.5314108264791), (48.2466097676995, 19.2199740585775), (49.0111025316085, 17.1787212134877), (45.2347327821924, 10.044872158239)]

    estimated_locations = [(47.17679515959783, 14.5931437800714), (36.68766150380683, 0.9806752621527973), (44.30862832597711, 4.077766224870866), (49.31503266357134, 12.886469336923547), (47.71587792453002, 8.540976532803034), (52.135663569466246, -4.881882066260463), (52.13245785149167, 20.673424913726077), (50.89569849652949, 16.146688159444412), (51.18553451933309, 16.655906711814982), (46.70372550931115, 8.523756172409232)]

    loc_perf = LocalizationPerformance(physical_locations, estimated_locations)
    return loc_perf

@pytest.fixture
def net_object(network_size):
    net = Network('now', network_size)
    return net.get_network()

@pytest.fixture
def prop_object(speed_func):
    prop = Propagation(speed_func)

    return prop

@pytest.fixture
def reference_coordinates():
    ref_locations = [
        # lines 2-11
        (48.3200536664685,17.3730031429023),    #1
        (37.296958333728,-7.16827975993671),    #2
        (43.9945935973249,1.94223265355784),    #3
        (50.0273740732463,14.2282159698372),    #4
        (52.1422852469279,8.90012187464632),    #5
        (51.5425455970012,-0.524754316417102),  #6
        (52.9583589143844,20.5314108264791),    #7
        (48.2466097676995,19.2199740585775),    #8
        (49.0111025316085,17.1787212134877),    #9
        (45.2347327821924,10.044872158239)      #10
    ]

    return ref_locations

@pytest.fixture
def location_estimate():
    # line 26
    loc_estimate = (45.457168566001,35.0218847122024)   #25

    return loc_estimate

@pytest.fixture
def my_measured_times():
    my_times = np.array([0.0207999987351644,0.0403852899153343,0.0315982400928896,0.0206491303399721,0.0232163019584066,0.0313142956020275,0.0212168518556044,0.0190997238594389,0.0195392442336077,0.0269385328683919])

    return my_times

@pytest.fixture
def their_measured_times():
    their_times = np.array([0.0216293782262918,0.0402697867628947,0.0315473818748311,0.0203570647624914,0.0245536181917579,0.0340079135970687,0.0238622558888451,0.0191199543772947,0.0198910333145327,0.0267000667288268])

    return their_times
